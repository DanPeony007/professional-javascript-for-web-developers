# 性能
## 1. 注意作用域
访问全局变量总是要比访问局部变量慢，因为需要遍历作用域链。只要能减少花费在作用域链上的时间，就能增加脚本的整体性能。 <br>
**避免全局查找** <br>
将一个函数中会用到多次的全局对象存储为局部变量，减少全局查找次数。 <br>
**避免 with 语句** <br>
在性能非常重要的地方必须避免使用 with 语句。和函数类似，with 语句会创建自己的作用域，会增加其中执行的代码的作用域链的长度。 <br>
with 语句主要用于消除额外的字符。大多数情况下，可以用局部变量完成相同的事情而不引入新的作用域。 <br>

## 2. 选择正确方法
**避免不必要的属性查找** <br>
O(1) 常数：不管有多少值，执行的时间都是恒定的。一般表示简单值和存储在变量中的值 <br>
O(log n) 对数：总执行时间和值的数量相关，但是要完成算法并不一定要获取每个值。例如：二分查找 <br>
O(n) 线性：总执行时间和值的数量直接相关。例如：遍历某个数组中的所有元素 <br>
O(n 2 ) 平方：总执行时间和值的数量有关，每个值至少要获取n次。例如：插入排序 <br>

```js
var query = window.location.href.substring(window.location.href.indexOf("?"));
// 多次用到对象属性，应该将其存储在局部变量中
var url = window.location.href;
var query = url.substring(url.indexOf("?"));
```

**优化循环** <br>
基本优化步骤： <br>
(1) **减值迭代**——大多数循环使用一个从 0 开始、增加到某个特定值的迭代器。在很多情况下，从最大值开始，在循环中不断减值的迭代器更加高效。 <br>
(2) **简化终止条件**——由于每次循环过程都会计算终止条件，所以必须保证它尽可能快。也就是说避免属性查找或其他 O(n) 的操作。 <br>
(3) **简化循环体**——循环体是执行最多的，所以要确保其被最大限度地优化。确保没有某些可以被很容易移出循环的密集计算。 <br>
(4) **使用后测试循环**——最常用 for 循环和 while 循环都是前测试循环。而如 do-while 这种后测试循环，可以避免最初终止条件的计算，因此运行更快。 <br>

**展开循环** <br>
当循环的次数是确定的，消除循环并使用多次函数调用往往更快 。 <br>
```js
//消除循环
process(values[0]);
process(values[1]);
process(values[2]);
```
如果循环中的迭代次数不能事先确定，可以考虑使用一种叫做 Duff 装置的技术。 <br>
Duff 装置的基本概念是通过计算迭代的次数是否为 8 的倍数将一个循环展开为一系列语句。 <br>
针对大数据集使用展开循环可以节省很多时间，对于小数据集，额外的开销可能得不偿失。 <br>

**避免双重解释** <br>
当 JavaScript 代码想解析 JavaScript 的时候就会存在双重解释惩罚。 <br>
当使用 eval() 函数或者是 Function 构造函数以及使用 setTimeout() 传一个字符串参数时都会发生这种情况。 <br>
```js
//某些代码求值——避免!!
eval("alert('Hello world!')");
//创建新函数——避免!!
var sayHi = new Function("alert('Hello world!')");
//设置超时——避免!!
setTimeout("alert('Hello world!')", 500);
```

修正方案：
```js
//已修正，除了极少情况eval()绝对必须，尽可能避免使用
alert('Hello world!');
//创建新函数——已修正，直接写成一般的函数
var sayHi = function(){
    alert('Hello world!');
};
//设置一个超时——已修正，传入函数作为第一个参数
setTimeout(function(){
    alert('Hello world!');
}, 500);
```

**性能的其他注意事项** <br>
**原生方法较快** —— 比如 Math 对象中的复杂的数学运算方法。 <br>
**Switch 语句较快** —— 一系列复杂 if-else 语句可以转换成单个 switch 语句，按照最可能的到最不可能的顺序，进一步优化 switch 语句。 <br>
**位运算符较快** —— 当进行数学运算的时候，位运算操作要比任何布尔运算或者算数运算快。选择性地用位运算替换算数运算可以极大提升复杂计算的性能。 <br>

## 3. 最小化语句数
完成多个操作的单个语句要比完成单个操作的多个语句快。 <br>

**多个变量声明** <br>
```js
// 一个语句
var count = 5,
    color = "blue",
    values = [1,2,3],
    now = new Date();
```

**插入迭代值** <br>
当使用迭代值（在不同的位置进行增加或减少的值）的时候，尽可能合并语句。 <br>
```js
var name = values[i];
i++;
// 一个语句
var name = values[i++];
```

**使用数组和对象字面量** <br>
两种创建数组和对象的方法：使用构造函数或者是使用字面量。 <br>
使用构造函数总是要用到更多的语句来插入元素或者定义属性，字面量可以将这些操作在一个语句中完成。 <br>

## 4. 优化 DOM 交互
DOM 操作与交互要消耗大量时间，因为它们往往需要重新渲染整个页面或者某一部分。 <br>

**最小化现场更新** <br>
一旦需要访问的 DOM 部分是已经显示的页面的一部分，就是在进行一个现场更新。因为需要立即（现场）对页面对用户的显示进行更新。 <br>
减少现场更新的数量，使用文档片段来构建 DOM 结构，再将其添加到现存的文档中。 <br>

**使用  innerHTML** <br>
两种在页面上创建 DOM 节点的方法： <br>
使用 createElement() 和 appendChild() 之类的 DOM 方法；使用 innerHTML。 <br>

当把 innerHTML 设置为某个值时，后台会创建一个 HTML 解析器，然后使用内部的 DOM调用来创建 DOM 结构，而非基于 JavaScript 的 DOM调用。由于内部方法是编译好的而非解释执行的，所以执行快得多。 <br>
使用 innerHTML 的关键在于（和其他 DOM 操作一样）最小化调用它的次数。 <br>

**使用事件代理** <br>
任何可以冒泡的事件都不仅仅可以在事件目标上进行处理，目标的任何祖先节点上也能处理。 <br>

**注意 HTMLCollection** <br>
最小化访问 HTMLCollection 的次数可以极大地改进脚本的性能。 <br>

以下情况会返回 HTMLCollection 对象： <br>
进行了对 getElementsByTagName() 的调用； <br>
获取了元素的  childNodes 属性； <br>
获取了元素的  attributes 属性； <br>
访问了特殊的集合，如 document.forms、document.images 等。 <br>

# 部署
## 1. 构建过程
为了协助部署，推荐设置一个可以将 JavaScript 合并为较少文件（理想情况是一个）的构建过程。 <br>

代码不应该原封不动地放入浏览器，需要构建的原因： <br>
知识产权问题； <br>
文件大小； <br>
代码组织。 <br>

构建过程始于在源控制中定义用于存储文件的逻辑结构。 <br>
最好避免使用一个文件存放所有的 JavaScript，遵循以下面向对象语言中的典型模式：将每个对象或自定义类型分别放入其单独的文件中。 <br>

将代码分离成多个文件只是为了提高可维护性，并非为了部署。 <br>
要进行部署的时候，需要将这些源代码合并为一个或几个归并文件。 <br>

一旦组织好文件和目录结构，并确定哪些要出现在部署文件中，就可以创建构建系统。 <br>
Ant 构建工具(http://ant.apache.org)，由于其简便的文件处理能力而非常适合 JavaScript 编译系统。 <br>

## 2. 验证
有些工具可以帮助确定 JavaScript 代码中潜在的问题，其中最著名的 JSLint。 <br>
JSLint 可以查找 JavaScript 代码中的语法错误以及常见的编码错误。 <br>
> eval() 的使用；  <br>
> 未声明变量的使用；  <br>
> 遗漏的分号；  <br>
> 不恰当的换行；  <br>
> 错误的逗号使用；  <br>
> 语句周围遗漏的括号；  <br>
> switch 分支语句中遗漏的 break ；  <br>
> 重复声明的变量；  <br>
> with 的使用；  <br>
> 错误使用的等号（替代了双等号或三等号）；  <br>
> 无法到达的代码。 <br>

给开发周期添加代码验证这个环节有助于避免将来可能出现的一些错误。 <br>

## 3. 压缩
JavaScript 文件压缩：代码长度和配重。 <br>
代码长度指的是浏览器所需解析的字节数，配重指的是实际从服务器传送到浏览器的字节数。 <br>

**文件压缩** <br>
压缩器一般进行如下一些步骤： <br>
删除额外的空白（包括换行）； <br>
删除所有注释； <br>
缩短变量名。 <br>
优秀的压缩工具 YUI 压缩器，YUI 压缩可以确保不引入任何语法错误，并可以安全地缩短局部变量名。 <br>
所有的 JavaScript 文件在部署到生产环境之前，都应该使用 YUI 压缩器或者类似的工具进行压缩。 <br>

**HTTP 压缩** <br>
服务器端可以使用服务器端相关功能来压缩 JavaScript 文件。所有的五大 Web 浏览器（IE、Firefox、Safari、Chrome 和 Opera）都支持对所接收的资源进行客户端解压缩。 <br>